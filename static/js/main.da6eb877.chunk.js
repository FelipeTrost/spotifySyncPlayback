(this.webpackJsonpregaloisaspotify=this.webpackJsonpregaloisaspotify||[]).push([[0],{82:function(e,t,a){e.exports=a(93)},88:function(e,t){function a(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}a.keys=function(){return[]},a.resolve=a,e.exports=a,a.id=88},93:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(9),l=a.n(c),o=a(12),s=a(23),i=a.n(s),u=a(10),m=a(36),d=a(19),p=a(42),b=a.n(p),f=a(43),E=a.n(f),y=a(121),h=a(28),v=a(127),O=a(128),g=a(135),j=a(136),k=a(72),x=a(141),w=a(124),C=a(126),N=a(139),S=a(133),_=a(134),P=a(132),I=a(137),D=a(129),M=a(66),F=a.n(M),A=a(47),W=a.n(A),B=Object(y.a)((function(e){var t;return{card:{width:"90%",maxWidth:600},root:(t={display:"flex",width:"90%",maxWidth:500},Object(d.a)(t,"display","flex"),Object(d.a)(t,"flexDirection","row"),Object(d.a)(t,"justifyContent","space-between"),t),details:{display:"flex",flexDirection:"column"},cover:{width:160,height:160},content:{flex:"1 0 auto"},selected:{color:"#1DB954"},header:{backgroundColor:"#1DB954"}}})),H=function(e){var t=Object(n.useState)(!1),a=Object(o.a)(t,2),c=a[0],l=a[1],s=Object(n.useState)({peerId:null,spotify:null,players:[],sellectedPlayer:null}),p=Object(o.a)(s,2),f=p[0],y=p[1],M=Object(n.useRef)(f);M.current=f;var A=Object(n.useState)(!1),H=Object(o.a)(A,2),T=H[0],U=H[1],z=Object(n.useState)(""),q=Object(o.a)(z,2),J=q[0],L=q[1],R=Object(n.useState)({connecting:!1,host:!1}),G=Object(o.a)(R,2),K=G[0],Q=G[1],V=Object(n.useState)(!1),X=Object(o.a)(V,2),Y=X[0],Z=X[1],$=B();Object(h.a)();Object(n.useEffect)((function(){Object(m.a)(i.a.mark((function t(){var a,n,r;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,(a=new E.a).setAccessToken(e.credentials.access_token),l(a),t.next=6,a.getMe().catch((function(e){return y((function(e){return Object(u.a)(Object(u.a)({},e),{},{spotify:{display_name:"Not found"}})}))}));case 6:n=t.sent,y((function(e){return Object(u.a)(Object(u.a)({},e),{},{spotify:n})})),(r=new b.a({host:"9000-ac62c345-f733-4f21-9741-dc1e6d1fdc2d.ws-us02.gitpod.io",secure:!0})).on("open",(function(e){console.log("connected to broker"),y((function(t){return Object(u.a)(Object(u.a)({},t),{},{peerId:e})}))})),r.on("connection",(function(e){console.log("rejected"),console.log(e),e.close()})),U(r),t.next=16;break;case 14:t.prev=14,t.t0=t.catch(0);case 16:case"end":return t.stop()}}),t,null,[[0,14]])})))()}),[]),Object(n.useEffect)((function(){ee()}),[f.spotify]);var ee=function(){if(!c)return null;y((function(e){return Object(u.a)(Object(u.a)({},e),{},{devices:[]})})),c.getMyDevices().then((function(e){return y((function(t){var a=0!==e.devices.length?0:null;return Object(u.a)(Object(u.a)({},t),{},{players:e.devices,sellectedPlayer:a})}))})).catch((function(e){return console.log("Hubo un error:",e)}))};return f.spotify&&f.peerId&&c&&f.players?r.a.createElement("div",Object(d.a)({className:"App"},"className",$.body),r.a.createElement(x.a,{in:!0},r.a.createElement(w.a,{position:"static",className:$.header},r.a.createElement(C.a,{variant:"dense"},r.a.createElement(k.a,{variant:"h6",className:$.title},f.spotify.display_name)))),r.a.createElement("br",null),r.a.createElement(x.a,{in:!0},r.a.createElement(v.a,{raised:!0,className:$.card},r.a.createElement(O.a,null,K.connecting?r.a.createElement(r.a.Fragment,null,r.a.createElement(D.a,{variant:"text",width:410}),r.a.createElement(D.a,{variant:"rect",width:410,height:50}),r.a.createElement(D.a,{variant:"text",width:410})):K.host?r.a.createElement(r.a.Fragment,null,r.a.createElement(k.a,null,"Connected to: ",K.host.peer)," ",r.a.createElement("br",null),r.a.createElement(_.a,{onClick:function(){K.host.close(),Z(!1)},variant:"outlined",color:"secondary"},"disconnect")):r.a.createElement(r.a.Fragment,null,r.a.createElement(k.a,{variant:"h6",component:"h6"},"Connect"),r.a.createElement("br",null),r.a.createElement(N.a,{label:"Id del host",value:J,onChange:function(e){return L(e.target.value)},InputProps:{startAdornment:r.a.createElement(S.a,{position:"start"},r.a.createElement(W.a,null))}}),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement(_.a,{onClick:function(){Q({connecting:!0,host:!1});var e=T.connect(J,console.error);e.on("open",(function(){console.log("Connected to another peer!!"),Q({connecting:!1,host:e}),e.on("data",function(){var e=Object(m.a)(i.a.mark((function e(t){var a,n,r,l,o,s,u,m;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=M.current,Z(t.song),0!==a.players.length){e.next=4;break}return e.abrupt("return",null);case 4:return e.next=6,c.getMyCurrentPlaybackState();case 6:if(n=e.sent,r=n.item,l=n.is_playing,o=n.progress_ms,s=n.device,u=n.timestamp,m=u-t.song.timestamp,r.uri!==t.song.item.uri||s.id!==a.players[a.sellectedPlayer]){e.next=18;break}return Math.abs(t.song.progress_ms+m-o)>3e3&&c.seek(t.song.progress_ms+m),t.song.is_playing!==l&&l&&c.pause(a.players[a.sellectedPlayer].id),t.song.is_playing===l||l||c.play({device_id:a.players[a.sellectedPlayer]}),e.abrupt("return",null);case 18:c.play({device_id:a.players[a.sellectedPlayer].id,uris:[t.song.item.uri],position_ms:o+m});case 19:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())})),e.on("close",(function(){Q({connecting:!1,host:!1})})),e.on("error",(function(e){console.error(e)}))}}," Connect "))))),r.a.createElement("br",null),Y&&r.a.createElement(x.a,{in:!0},r.a.createElement(v.a,{raised:!0,className:$.root},r.a.createElement("div",{className:$.details},r.a.createElement(O.a,{className:$.content},r.a.createElement(k.a,{component:"h5",variant:"h5"},Y.item.name),r.a.createElement(k.a,{variant:"subtitle1",color:"textSecondary"},Y.item.artists[0].name),r.a.createElement(k.a,{variant:"subtitle1",color:"textSecondary"},new Date(Y.progress_ms).toISOString().substr(15,4)))),r.a.createElement(g.a,{className:$.cover,image:Y.item.album.images[1].url,title:"Live from space album cover",component:"img"}))),r.a.createElement("br",null),r.a.createElement(x.a,{in:!0},r.a.createElement(v.a,{raised:!0,className:$.card},r.a.createElement(O.a,null,r.a.createElement(k.a,{variant:"h6",component:"h6"},"Players",r.a.createElement(j.a,{onClick:ee},r.a.createElement(F.a,null))),0===f.players.length&&r.a.createElement("h4",null,"No connected devices ",f.sellectedPlayer," "),r.a.createElement(P.a,{maxWidth:"md"},f.players.map((function(e,t){return r.a.createElement(I.a,{button:!0,key:e.id,className:f.sellectedPlayer==t?$.selected:"",onClick:function(){return y((function(e){return Object(u.a)(Object(u.a)({},e),{},{sellectedPlayer:t})}))}},r.a.createElement(k.a,null," ",e.name," type:",e.type))}))))))):r.a.createElement(r.a.Fragment,null,r.a.createElement(D.a,{variant:"text",width:410}),r.a.createElement(D.a,{variant:"text",width:410}),r.a.createElement(D.a,{variant:"rect",width:410,height:118}))},T=a(70),U=a(69),z=a(67),q=a.n(z),J=Object(y.a)((function(e){return{card:{width:"90%",maxWidth:600},header:{backgroundColor:"#1DB954"}}}));var L=function(e){var t=J(),a=(Object(h.a)(),Object(n.useState)(!1)),c=Object(o.a)(a,2),l=c[0],s=c[1],p=Object(n.useState)(!1),f=Object(o.a)(p,2),y=(f[0],f[1]),g=Object(n.useState)({peerId:null,spotify:null,players:[]}),N=Object(o.a)(g,2),S=N[0],_=N[1],M=Object(n.useState)({}),F=Object(o.a)(M,2),A=F[0],B=F[1],H=Object(n.useRef)(A);return H.current=A,Object(n.useEffect)((function(){var t=new E.a;t.setAccessToken(e.credentials.access_token),s(t),t.getMe().then((function(e){return _((function(t){return Object(u.a)(Object(u.a)({},t),{},{spotify:e})}))})).catch((function(e){return _((function(e){return Object(u.a)(Object(u.a)({},e),{},{spotify:{display_name:"Not found"}})}))}));var a=new b.a({host:"9000-ac62c345-f733-4f21-9741-dc1e6d1fdc2d.ws-us02.gitpod.io",secure:!0});a.on("open",(function(e){console.log("connected"),_((function(t){return Object(u.a)(Object(u.a)({},t),{},{peerId:e})}))})),a.on("connection",(function(e){var t;console.log("Peer connected:",e.peer),e.on("close",(function(){console.log("peer disconnected"),B((function(t){var a=e.peer;t[a];return Object(T.a)(t,[a].map(U.a))}))})),t=e,B((function(e){return console.log("adding",t),Object(u.a)(Object(u.a)({},e),{},Object(d.a)({},t.peer,t))}))})),y(a);var n=setInterval(Object(m.a)(i.a.mark((function e(){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(Object.keys(H.current).length<1)){e.next=2;break}return e.abrupt("return",null);case 2:return e.next=4,t.getMyCurrentPlaybackState();case 4:if(a=e.sent){e.next=7;break}return e.abrupt("return",null);case 7:Object.keys(H.current).forEach((function(e){console.log(H.current[e].send),H.current[e].send({song:a})}));case 8:case"end":return e.stop()}}),e)}))),1e3);return function(){return clearInterval(n)}}),[]),S.spotify&&l&&S.players&&S.peerId?r.a.createElement("div",{className:"App"},r.a.createElement(x.a,{in:!0},r.a.createElement(w.a,{position:"static",className:t.header},r.a.createElement(C.a,{variant:"dense"},r.a.createElement(k.a,{variant:"h6",className:t.title},S.spotify.display_name)))),r.a.createElement("br",null),r.a.createElement(x.a,{in:!0},r.a.createElement(v.a,{raised:!0,className:t.card},r.a.createElement(O.a,null,r.a.createElement(k.a,{variant:"h6",component:"h6"},r.a.createElement(W.a,{size:"large"}),"Host id"),r.a.createElement(k.a,null,S.peerId,r.a.createElement(j.a,{onClick:function(){return function(e){var t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)}(S.peerId)}},r.a.createElement(q.a,null)))))),r.a.createElement("br",null),r.a.createElement(x.a,{in:!0},r.a.createElement(v.a,{raised:!0,className:t.card},r.a.createElement(O.a,null,r.a.createElement(k.a,{variant:"h6",component:"h6"},"Connected Clients:"),r.a.createElement(P.a,{maxWidth:"md"},Object.keys(A).map((function(e){return r.a.createElement(I.a,{key:e},r.a.createElement(k.a,null," ",e))})),S.players.map((function(e,a){return r.a.createElement(I.a,{button:!0,key:e.id,className:S.sellectedPlayer==a?t.selected:"",onClick:function(){return _((function(e){return Object(u.a)(Object(u.a)({},e),{},{sellectedPlayer:a})}))}},r.a.createElement(k.a,null," ",e.name," type:",e.type))}))))))):r.a.createElement(r.a.Fragment,null,r.a.createElement(D.a,{variant:"text",width:410}),r.a.createElement(D.a,{variant:"text",width:410}),r.a.createElement(D.a,{variant:"rect",width:410,height:118}))},R=a(68),G=a.n(R),K=a(140),Q=a(142),V=a(138),X=a(130),Y=a(131);var Z=function(){var e=Object(n.useState)({status:!1,credentials:null}),t=Object(o.a)(e,2),a=t[0],c=t[1],l=Object(n.useState)("user"),s=Object(o.a)(l,2),i=s[0],u=s[1];return a.status?a.status?"host"===i?r.a.createElement(L,{credentials:a.credentials}):r.a.createElement(H,{credentials:a.credentials}):"No se pudo":r.a.createElement(r.a.Fragment,null,r.a.createElement(x.a,{in:!0},r.a.createElement("div",null,r.a.createElement(G.a,{clientId:"eff635f26c1c4116bc9cecca8ea22d17",redirectUri:"https://felipetrost.github.io/spotifySyncPlayback/",scope:["streaming","user-read-email","user-read-private","user-read-playback-state","user-modify-playback-state"],onSuccess:function(e){return c({status:!0,credentials:e})},onFailure:function(e){return c({status:!1,credentials:!1})},buttonText:r.a.createElement(_.a,{type:"submit",variant:"outlined",color:"primary"},"Entrar con spotify")}))),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement("div",null,r.a.createElement(X.a,{component:"fieldset"},r.a.createElement(x.a,{in:!0},r.a.createElement(Y.a,{component:"legend"},"Modalidad:")),r.a.createElement(x.a,{in:!0},r.a.createElement(Q.a,{"aria-label":"quiz",name:"quiz",value:i,onChange:function(e){return u(e.target.value)}},r.a.createElement(V.a,{value:"host",control:r.a.createElement(K.a,null),label:"Host"}),r.a.createElement(V.a,{value:"user",control:r.a.createElement(K.a,null),label:"User"}))))),!1===a.credentials&&r.a.createElement("h4",null,"Hubo un problema con el inicio de sesion"))};l.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(Z,null)),document.getElementById("root"))}},[[82,1,2]]]);
//# sourceMappingURL=main.da6eb877.chunk.js.map